(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4036357f"],{2909:function(t,e,i){"use strict";function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function r(t){if(Array.isArray(t))return s(t)}i.d(e,"a",(function(){return c}));i("a4d3"),i("e01a"),i("d3b7"),i("d28b"),i("3ca3"),i("ddb0"),i("a630");function a(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}i("fb6a"),i("b0c0");function n(t,e){if(t){if("string"===typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t){return r(t)||a(t)||n(t)||o()}},"498a":function(t,e,i){"use strict";var s=i("23e7"),r=i("58a8").trim,a=i("c8d2");s({target:"String",proto:!0,forced:a("trim")},{trim:function(){return r(this)}})},"4df4":function(t,e,i){"use strict";var s=i("0366"),r=i("7b0b"),a=i("9bdd"),n=i("e95a"),o=i("50c4"),c=i("8418"),l=i("35a1");t.exports=function(t){var e,i,u,d,m,f,h=r(t),v="function"==typeof this?this:Array,_=arguments.length,p=_>1?arguments[1]:void 0,g=void 0!==p,b=l(h),y=0;if(g&&(p=s(p,_>2?arguments[2]:void 0,2)),void 0==b||v==Array&&n(b))for(e=o(h.length),i=new v(e);e>y;y++)f=g?p(h[y],y):h[y],c(i,y,f);else for(d=b.call(h),m=d.next,i=new v;!(u=m.call(d)).done;y++)f=g?a(d,p,[u.value,y],!0):u.value,c(i,y,f);return i.length=y,i}},"72cc":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main_container"},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isEnterRoom||!t.isSmallSize,expression:"!isEnterRoom || !isSmallSize"}],staticClass:"middle__content"},[i("ChatList",{attrs:{"initial-chats":t.chats},on:{"after-enter":t.handelAfterEnter}})],1),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isSmallSize||t.isEnterRoom,expression:"!isSmallSize || isEnterRoom"}],staticClass:"right__content"},[i("PrivateChatRoom",{attrs:{"initial-listener":t.listener,"initial-messages":t.messages,"is-small-size":t.isSmallSize,"enter-room":t.isEnterRoom},on:{"after-submit":t.handleAfterSubmit,"previous-page":t.goPreviousPage}})],1)])},r=[],a=i("1da1"),n=i("5530"),o=(i("96cf"),i("b0c0"),i("a434"),i("159b"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chat_container"},[t._m(0),t._l(t.chats,(function(e){return i("div",{key:e.id,staticClass:"post",class:{unread:!e.isRead},on:{click:function(i){return i.stopPropagation(),i.preventDefault(),t.enterRoom(e.id)}}},[i("router-link",{attrs:{to:{name:"user-tweets",params:{id:e.id}}}},[i("div",{staticClass:" post__avatar"},[i("img",{staticClass:"avatar-img",attrs:{src:t._f("emptyImage")(e.avatar),alt:""}})])]),i("div",{staticClass:"post-content"},[i("div",{staticClass:"post-title mb-2"},[i("span",{staticClass:"post-title-item user-name"},[t._v(" "+t._s(e.name)+" ")]),i("span",{staticClass:"post-title-item post-title-item-account"},[t._v("@"+t._s(e.account))]),i("span",{staticClass:"post-title-item post-title-item-time"},[t._v(" "+t._s(t._f("shortenTime")(e.createdAt))+" ")])]),i("div",{staticClass:"post-discription"},[t._v(" "+t._s(e.content)+" ")])])],1)}))],2)}),c=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"chat_container__title"},[t._v(" 訊息 "),i("div",{staticClass:"icon-image"}),i("div",{staticClass:"plus"},[t._v(" + ")])])}],l=i("2909"),u=(i("4de4"),i("2708")),d={name:"ChatList",mixins:[u["e"],u["a"]],props:{initialChats:{type:Array,required:!0}},data:function(){return{chats:this.initialChats}},watch:{initialChats:function(t){this.chats=Object(l["a"])(t)}},methods:{enterRoom:function(t){var e=this.chats.filter((function(e){return e.id===t}));this.$emit("after-enter",e[0])}}},m=d,f=(i("ec12"),i("2877")),h=Object(f["a"])(m,o,c,!1,null,"2998a854",null),v=h.exports,_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("form",{attrs:{action:""},on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[i("div",{staticClass:"chat__room__container"},[i("div",{staticClass:"chat__room__top__wrapper"},[i("span",{directives:[{name:"show",rawName:"v-show",value:t.isSmallSize,expression:"isSmallSize"}],staticClass:"chat__room__back",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.goBack.apply(null,arguments)}}},[t._v(" ←")]),i("div",{staticClass:"chat__room__title"},[t._v(" "+t._s(t.initialListener.name?t.initialListener.name:"聊天室")+" ")])]),i("div",{ref:"main",staticClass:"chat__room__main__wrapper"},t._l(t.allData,(function(e){return i("div",{key:e.messageId},[i("div",{staticClass:"chat__room__message__wrapper"},[e.id!==t.currentUser.id?i("div",{staticClass:"chat__room__left__wrapper"},[i("div",{staticClass:"chat__room__user"},[i("img",{staticClass:"user__image",attrs:{src:t._f("emptyImage")(e.avatar),alt:""}}),i("div",{staticClass:"chat__room__text__container"},[i("div",{staticClass:"chat__room__text__wrapper"},[i("div",{staticClass:"chat__room__text"},[t._v(" "+t._s(e.content)+" ")])]),i("div",{staticClass:"chat__room__time"},[t._v(" "+t._s(t._f("shortenTime")(e.createdAt))+" ")])])])]):t._e(),e.id===t.currentUser.id?i("div",{staticClass:"chat__room__right__wrapper"},[i("div",{staticClass:"chat__room__right__text__wrapper"},[i("div",{staticClass:"chat__room__right__text"},[t._v(" "+t._s(e.content)+" ")])]),i("div",{staticClass:"chat__room__time"},[t._v(" "+t._s(t._f("shortenTime")(e.createdAt))+" ")])]):t._e()])])})),0),t.initialListener.name?i("div",{staticClass:"chat__room__bottom__wrapper"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"chat__room__input",attrs:{type:"text",placeholder:"請輸入訊息..."},domProps:{value:t.message},on:{input:function(e){e.target.composing||(t.message=e.target.value)}}}),i("button",{staticClass:"chat__room__button",attrs:{type:"submit"}})]):i("div",{staticClass:"empty-message"},[t._v(" 請先選擇訊息就可以開啟對話囉！ ")])])])},p=[],g=(i("498a"),i("2f62")),b=i("c968"),y={name:"PrivateChatRoom",mixins:[u["e"],u["a"]],props:{initialListener:{type:[Array,Object],required:!0},initialMessages:{type:[Array,Object],required:!0},isSmallSize:{type:Boolean,default:!1},enterRoom:{type:Boolean,default:!1}},data:function(){return{message:"",allData:this.initialMessages}},computed:Object(n["a"])({},Object(g["b"])(["currentUser"])),created:function(){this.scrollToEnd()},mounted:function(){this.scrollToEnd()},updated:function(){this.scrollToEnd()},methods:{goBack:function(){this.$emit("previous-page",!1)},handleSubmit:function(){this.message?this.message.trim()?(this.$socket.emit("privateMessage",{id:this.currentUser.id,listenerId:this.initialListener.id,content:this.message,createdAt:new Date,avatar:this.currentUser.avatar}),this.message="",this.$emit("after-submit")):b["a"].fire({icon:"warning",title:"送一堆空格要幹嘛!?"}):b["a"].fire({icon:"warning",title:"沒有話要說，就不要亂按"})},scrollToEnd:function(){this.$refs.main.scrollTop=this.$refs.main.scrollHeight}}},w=y,C=(i("9c44"),Object(f["a"])(w,_,p,!1,null,"00f92a1c",null)),S=C.exports,x=i("d3cc"),E={name:"PrivateChatViews",components:{ChatList:v,PrivateChatRoom:S},data:function(){return{listener:{},chats:[],messages:[],isPrivate:!0,isSmallSize:!1,isEnterRoom:!1}},computed:Object(n["a"])({},Object(g["b"])(["currentUser","privateChatUser"])),watch:{listener:function(t,e){-1!==t.id&&-1!==e.id&&this.$socket.emit("leaveRoom",{id:this.currentUser.id,listenerId:e.id})}},beforeRouteEnter:function(t,e,i){var s=e.params.id||-1;i((function(t){t.listener.id=s}))},created:function(){this.$socket.connect(),this.getPrivateUsersList(),this.listener=this.privateChatUser,window.addEventListener("resize",this.resizeEvent)},mounted:function(){window.innerWidth<992&&(this.isSmallSize=!0,-1!==this.privateChatUser.id&&(this.isEnterRoom=!0)),this.$socket.emit("enterPrivateInterface",{id:this.currentUser.id,listenerId:this.listener.id}),-1!==this.listener.id&&this.$socket.emit("enterRoom",{id:this.currentUser.id,listenerId:this.listener.id}),this.getPrivateUsersList()},beforeRouteUpdate:function(){this.$socket.connect()},beforeDestroy:function(){console.log("leave"),window.removeEventListener("resize",this.resizeEvent),this.privateChatUser.id=-1,this.privateChatUser.name="",this.privateChatUser.account="",this.$socket.emit("leaveRoom",{id:this.currentUser.id,listenerId:this.listener.id}),console.log("leave room event",{id:this.currentUser.id,listenerId:this.listener.id})},sockets:{connect:function(){console.log("socket connected in private chat")},disconnect:function(){console.log("socket disconnected")},privateMessage:function(t){this.messages.push(t)},messageNotify:function(t){console.log("component messageNotifydata",t),this.getPrivateUsersList()}},methods:{resizeEvent:function(t){var e=window.innerWidth;this.isSmallSize=e<=992},goPreviousPage:function(t){this.isEnterRoom=t},handelAfterEnter:function(t){console.log("handelAfterEnter",t),this.listener=t;var e=this.messages.length;this.messages.splice(0,e),this.$socket.emit("enterRoom",{id:this.currentUser.id,listenerId:t.id}),this.historyMessage(t.id),this.isSmallSize&&(this.isEnterRoom=!0)},handleAfterSubmit:function(){this.getPrivateUsersList()},getPrivateUsersList:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var i,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,x["a"].getPrivateUsers(t.currentUser.id);case 2:i=e.sent,s=i.data,t.chats=s,console.log(s);case 6:case"end":return e.stop()}}),e)})))()},historyMessage:function(t){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function i(){var s,r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,x["a"].messages({isPrivate:!0,id:e.currentUser.id,listenerId:t});case 3:s=i.sent,r=s.data,0===e.messages.length&&r.forEach((function(t){t=JSON.parse(JSON.stringify(t)),e.messages.push(t)})),i.next=11;break;case 8:i.prev=8,i.t0=i["catch"](0),console.log(i.t0);case 11:case"end":return i.stop()}}),i,null,[[0,8]])})))()}}},A=E,U=(i("7daa"),Object(f["a"])(A,s,r,!1,null,"8871f344",null));e["default"]=U.exports},"7daa":function(t,e,i){"use strict";i("ce1f")},"99af":function(t,e,i){"use strict";var s=i("23e7"),r=i("d039"),a=i("e8b5"),n=i("861d"),o=i("7b0b"),c=i("50c4"),l=i("8418"),u=i("65f0"),d=i("1dde"),m=i("b622"),f=i("2d00"),h=m("isConcatSpreadable"),v=9007199254740991,_="Maximum allowed index exceeded",p=f>=51||!r((function(){var t=[];return t[h]=!1,t.concat()[0]!==t})),g=d("concat"),b=function(t){if(!n(t))return!1;var e=t[h];return void 0!==e?!!e:a(t)},y=!p||!g;s({target:"Array",proto:!0,forced:y},{concat:function(t){var e,i,s,r,a,n=o(this),d=u(n,0),m=0;for(e=-1,s=arguments.length;e<s;e++)if(a=-1===e?n:arguments[e],b(a)){if(r=c(a.length),m+r>v)throw TypeError(_);for(i=0;i<r;i++,m++)i in a&&l(d,m,a[i])}else{if(m>=v)throw TypeError(_);l(d,m++,a)}return d.length=m,d}})},"9bdd":function(t,e,i){var s=i("825a"),r=i("2a62");t.exports=function(t,e,i,a){try{return a?e(s(i)[0],i[1]):e(i)}catch(n){throw r(t),n}}},"9c44":function(t,e,i){"use strict";i("f7ab")},a434:function(t,e,i){"use strict";var s=i("23e7"),r=i("23cb"),a=i("a691"),n=i("50c4"),o=i("7b0b"),c=i("65f0"),l=i("8418"),u=i("1dde"),d=u("splice"),m=Math.max,f=Math.min,h=9007199254740991,v="Maximum allowed length exceeded";s({target:"Array",proto:!0,forced:!d},{splice:function(t,e){var i,s,u,d,_,p,g=o(this),b=n(g.length),y=r(t,b),w=arguments.length;if(0===w?i=s=0:1===w?(i=0,s=b-y):(i=w-2,s=f(m(a(e),0),b-y)),b+i-s>h)throw TypeError(v);for(u=c(g,s),d=0;d<s;d++)_=y+d,_ in g&&l(u,d,g[_]);if(u.length=s,i<s){for(d=y;d<b-s;d++)_=d+s,p=d+i,_ in g?g[p]=g[_]:delete g[p];for(d=b;d>b-s+i;d--)delete g[d-1]}else if(i>s)for(d=b-s;d>y;d--)_=d+s-1,p=d+i-1,_ in g?g[p]=g[_]:delete g[p];for(d=0;d<i;d++)g[d+y]=arguments[d+2];return g.length=b-s+i,u}})},a630:function(t,e,i){var s=i("23e7"),r=i("4df4"),a=i("1c7e"),n=!a((function(t){Array.from(t)}));s({target:"Array",stat:!0,forced:n},{from:r})},c8d2:function(t,e,i){var s=i("d039"),r=i("5899"),a="​᠎";t.exports=function(t){return s((function(){return!!r[t]()||a[t]()!=a||r[t].name!==t}))}},cb1a:function(t,e,i){},ce1f:function(t,e,i){},d28b:function(t,e,i){var s=i("746f");s("iterator")},d3cc:function(t,e,i){"use strict";i("99af");var s=i("c968");e["a"]={getPrivateUsers:function(t){return s["b"].get("/messages/users/".concat(t,"/messaged"))},messages:function(t){var e=t.isPrivate,i=t.id,r=t.listenerId;return s["b"].get("/messages?isPrivate=".concat(e,"&id=").concat(i,"&listenerId=").concat(r))}}},e01a:function(t,e,i){"use strict";var s=i("23e7"),r=i("83ab"),a=i("da84"),n=i("5135"),o=i("861d"),c=i("9bf2").f,l=i("e893"),u=a.Symbol;if(r&&"function"==typeof u&&(!("description"in u.prototype)||void 0!==u().description)){var d={},m=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof m?new u(t):void 0===t?u():u(t);return""===t&&(d[e]=!0),e};l(m,u);var f=m.prototype=u.prototype;f.constructor=m;var h=f.toString,v="Symbol(test)"==String(u("test")),_=/^Symbol\((.*)\)[^)]+$/;c(f,"description",{configurable:!0,get:function(){var t=o(this)?this.valueOf():this,e=h.call(t);if(n(d,t))return"";var i=v?e.slice(7,-1):e.replace(_,"$1");return""===i?void 0:i}}),s({global:!0,forced:!0},{Symbol:m})}},ec12:function(t,e,i){"use strict";i("cb1a")},f7ab:function(t,e,i){},fb6a:function(t,e,i){"use strict";var s=i("23e7"),r=i("861d"),a=i("e8b5"),n=i("23cb"),o=i("50c4"),c=i("fc6a"),l=i("8418"),u=i("b622"),d=i("1dde"),m=d("slice"),f=u("species"),h=[].slice,v=Math.max;s({target:"Array",proto:!0,forced:!m},{slice:function(t,e){var i,s,u,d=c(this),m=o(d.length),_=n(t,m),p=n(void 0===e?m:e,m);if(a(d)&&(i=d.constructor,"function"!=typeof i||i!==Array&&!a(i.prototype)?r(i)&&(i=i[f],null===i&&(i=void 0)):i=void 0,i===Array||void 0===i))return h.call(d,_,p);for(s=new(void 0===i?Array:i)(v(p-_,0)),u=0;_<p;_++,u++)_ in d&&l(s,u,d[_]);return s.length=u,s}})}}]);
//# sourceMappingURL=chunk-4036357f.080dd4f7.js.map