(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b23adcb2"],{"011d":function(t,e,s){},"170c":function(t,e,s){"use strict";s("69d6")},2375:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement;t._self._c;return t._m(0)},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"spin"},[s("div",{staticClass:"lds-roller"},[s("div"),s("div"),s("div"),s("div"),s("div"),s("div"),s("div"),s("div")])])}],n={},r=n,o=(s("170c"),s("2877")),c=Object(o["a"])(r,i,a,!1,null,"469b7f34",null);e["a"]=c.exports},"27c5":function(t,e,s){},"374e":function(t,e,s){"use strict";s("c30a")},"418b":function(t,e,s){"use strict";s("011d")},4385:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"top-wrapper"},[t.isLoading?s("Spinner",{staticClass:"mt-5"}):[s("TweetForm",{on:{"after-submit":t.handleAfterSubmit}}),t.tweets.length?t._l(t.tweets,(function(t){return s("UserPost",{key:t.id,attrs:{"initial-tweet":t}})})):t._e()]],2)},a=[],n=s("1da1"),r=s("5530"),o=(s("b0c0"),s("96cf"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"tweet__form__container"},[s("form",{staticClass:"tweet__form__wrapper"},[s("div",{staticClass:"tweet__form__emoji"},[s("EmojiPicker",{on:{"add-emoji":t.addEmoji}})],1),s("div",{staticClass:"tweet__form__image__wrapper"},[s("div",{staticClass:"tweet__form__image"},[s("img",{staticClass:"avatar-img",attrs:{src:t._f("emptyImage")(t.currentUser.avatar),alt:""}})]),s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.description,expression:"description"}],staticClass:"tweet__form__input",attrs:{type:"text",rows:"4",cols:"50",maxlength:"140",placeholder:"有什麼新鮮事?"},domProps:{value:t.description},on:{input:function(e){e.target.composing||(t.description=e.target.value)}}})]),s("div",{staticClass:"tweet__form__button__wrapper"},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.description,expression:"description"}],staticClass:"alert-text",class:{hint:t.description.length>130}},[t._v(" "+t._s(t.countNum)+" ")]),s("button",{staticClass:"tweet__form__button",attrs:{type:"submit",disabled:t.isProcessing},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[t._v(" "+t._s(t.isProcessing?"處理中":"推文")+" ")])])])])}),c=[],l=(s("a4d3"),s("e01a"),s("498a"),s("c968")),u=s("2708"),_=s("2f62"),p=s("c9e1"),d={components:{EmojiPicker:p["a"]},mixins:[u["a"]],data:function(){return{description:"",isProcessing:!1}},computed:Object(r["a"])(Object(r["a"])({},Object(_["b"])(["currentUser","isAuthenticated"])),{},{countNum:function(){return 140-this.description.length}}),methods:{addEmoji:function(t){this.description+=t},handleSubmit:function(){return this.isProcessing=!0,this.description.trim()?this.description.length>140?(l["a"].fire({icon:"warning",title:"字數請限制於 140 字內"}),void(this.isProcessing=!1)):(this.$emit("after-submit",this.description),this.description="",void(this.isProcessing=!1)):(l["a"].fire({icon:"warning",title:"請輸入推文內容"}),void(this.isProcessing=!1))}}},m=d,f=(s("374e"),s("2877")),v=Object(f["a"])(m,o,c,!1,null,"23e3e743",null),w=v.exports,h=s("f949"),b=s("6783"),k=s("2375"),C={name:"Mainpage",components:{TweetForm:w,UserPost:h["a"],Spinner:k["a"]},props:{newTweet:{type:Object,required:!0}},data:function(){return{tweets:[],isLoading:!0}},computed:Object(r["a"])({},Object(_["b"])(["currentUser"])),watch:{newTweet:function(t){this.fetchTweets()}},created:function(){this.fetchTweets()},methods:{fetchTweets:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b["a"].getTweets();case 3:s=e.sent,i=s.data,t.tweets=i,t.isLoading=!1,e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](0),console.log("errer",e.t0),l["a"].fire({icon:"error",title:"無法顯示Tweets，請稍後再試"});case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))()},handleAfterSubmit:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){var i,a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,b["a"].create({description:t});case 3:if(i=s.sent,a=i.data,"success"===a.status){s.next=7;break}throw new Error(a.message);case 7:e.$socket.emit("subscribeNotify",{id:e.currentUser.id,content:t,avatar:e.currentUser.avatar,name:e.currentUser.name,labelName:"tweet"}),e.fetchTweets(),s.next=15;break;case 11:s.prev=11,s.t0=s["catch"](0),console.log("error",s.t0),l["a"].fire({icon:"error",title:"目前無法新增 Tweet，請稍後再試"});case 15:case"end":return s.stop()}}),s,null,[[0,11]])})))()}}},g=C,x=(s("418b"),Object(f["a"])(g,i,a,!1,null,"2f4e7ba9",null));e["default"]=x.exports},"69d6":function(t,e,s){},be43:function(t,e,s){"use strict";s("27c5")},c30a:function(t,e,s){},f949:function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"post__container"},[s("div",{staticClass:"post"},[s("router-link",{attrs:{to:{name:"user-tweets",params:{id:t.post.User.id}}}},[s("div",{staticClass:" post__avatar"},[s("img",{staticClass:"avatar-img",attrs:{src:t._f("emptyImage")(t.post.User.avatar),alt:""}})])]),s("router-link",{attrs:{to:{name:"detail-tweet",params:{id:t.post.TweetId}}}},[s("div",{staticClass:"post__content"},[s("router-link",{attrs:{to:{name:"user-tweets",params:{id:t.post.User.id}}}},[s("div",{staticClass:"post__content__title mb-2"},[s("span",{staticClass:"post__content__title__item user-name"},[t._v(" "+t._s(t.post.User.name)+" ")]),s("span",{staticClass:"post__content__title__item"},[t._v("@"+t._s(t.post.User.account))]),s("span",{staticClass:"post__content__title__item"},[t._v("·")]),s("span",{staticClass:"post__content__title__item post__content__title__item__time"},[t._v(" "+t._s(t._f("fromNow")(t.post.createdAt))+" ")])])]),s("div",{staticClass:"post__content__discription"},[t._v(" "+t._s(t.post.description)+" ")])],1)]),s("div",{staticClass:"post__reaction d-flex "},[s("div",{staticClass:"post__reaction__item message ",on:{click:function(e){t.showModal=!0}}},[s("div",{staticClass:"post__reaction__item__message "}),s("span",{staticClass:"post__reaction__item__text"},[t._v(t._s(t.post.replyCount))])]),s("div",{staticClass:"post__reaction__item "},[t.post.isLike?s("div",{staticClass:"post__reaction__item__container",on:{click:function(e){return t.removeLiked(t.post.TweetId)}}},[s("div",{staticClass:"post__reaction__item__heart--liked"}),s("span",{staticClass:"post__reaction__item__text",class:{liked:t.post.isLike}},[t._v(t._s(t.post.likeCount))])]):s("div",{staticClass:"post__reaction__item__container heart",on:{click:function(e){return t.addLiked(t.post.TweetId)}}},[s("div",{staticClass:"post__reaction__item__heart"}),s("span",{staticClass:"post__reaction__item__text",class:{liked:t.post.isLike}},[t._v(t._s(t.post.likeCount))])])])])],1),t.showModal?[s("ReplyPostModal",{attrs:{"initial-tweet":t.initialTweet},on:{close:function(e){t.showModal=!1},"after-submit":t.handleAfterSubmit}})]:t._e()],2)},a=[],n=s("1da1"),r=s("5530"),o=(s("96cf"),s("b0c0"),s("c968")),c=s("2708"),l=s("cf6a"),u=s("4cce"),_=s("2f62"),p={name:"UserPost",components:{ReplyPostModal:l["default"]},mixins:[c["b"],c["a"]],props:{initialTweet:{type:Object,required:!0}},data:function(){return{showModal:!1,post:this.initialTweet,likeCount:this.initialTweet.likeCount}},computed:Object(r["a"])({},Object(_["b"])(["currentUser"])),watch:{initialTweet:function(t){this.post=Object(r["a"])(Object(r["a"])({},this.post),t)},likeCount:function(t){this.likeCount=this.post.likeCount}},methods:{handleAfterSubmit:function(){this.post.replyCount=this.post.replyCount+1},addLiked:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){var i,a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,u["a"].addLike({tweetId:t});case 3:if(i=s.sent,a=i.data,"success"===a.status){s.next=7;break}throw new Error(a.message);case 7:e.post.TweetId===t&&(e.post=Object(r["a"])(Object(r["a"])({},e.post),{},{isLike:!0,likeCount:e.post.likeCount+1})),e.likeCount+=1,e.$socket.emit("reactionNotify",{id:e.currentUser.id,receiverId:e.post.User.id,avatar:e.currentUser.avatar,name:e.currentUser.name,labelName:"like"}),s.next=16;break;case 12:s.prev=12,s.t0=s["catch"](0),console.log(s.t0),o["a"].fire({icon:"error",title:"喜歡貼文失敗，請稍候再試"});case 16:case"end":return s.stop()}}),s,null,[[0,12]])})))()},removeLiked:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){var i,a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,u["a"].removeLike({tweetId:t});case 3:if(i=s.sent,a=i.data,"success"===a.status){s.next=7;break}throw new Error(a.message);case 7:e.post.TweetId===t&&(e.post=Object(r["a"])(Object(r["a"])({},e.post),{},{isLike:!1,likeCount:e.post.likeCount-1})),e.likeCount-=1,s.next=15;break;case 11:s.prev=11,s.t0=s["catch"](0),console.log(s.t0),o["a"].fire({icon:"error",title:"取消喜歡失敗，請稍候再試"});case 15:case"end":return s.stop()}}),s,null,[[0,11]])})))()}}},d=p,m=(s("be43"),s("2877")),f=Object(m["a"])(d,i,a,!1,null,"61bdd2a2",null);e["a"]=f.exports}}]);
//# sourceMappingURL=chunk-b23adcb2.b0104914.js.map