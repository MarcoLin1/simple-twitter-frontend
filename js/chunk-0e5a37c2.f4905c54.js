(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e5a37c2"],{"170c":function(e,t,i){"use strict";i("69d6")},2375:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},s=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"spin"},[i("div",{staticClass:"lds-roller"},[i("div"),i("div"),i("div"),i("div"),i("div"),i("div"),i("div"),i("div")])])}],r={},n=r,c=(i("170c"),i("2877")),o=Object(c["a"])(n,a,s,!1,null,"469b7f34",null);t["a"]=o.exports},"3d88":function(e,t,i){"use strict";i("9905")},"69d6":function(e,t,i){},7107:function(e,t,i){},9905:function(e,t,i){},a604:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.isLoading?i("Spinner",{staticClass:"mt-5"}):[i("TweetInfo",{attrs:{"initial-tweet":e.tweet},on:{"after-submit":e.addTweetAfterSubmit}}),e._l(e.replies,(function(t){return i("Messages",{key:t.id,attrs:{"initial-user":e.user,"initial-reply":t}})}))]],2)},s=[],r=i("1da1"),n=i("5530"),c=(i("b0c0"),i("96cf"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{},[i("div",{staticClass:"tweet__info__container"},[i("div",{staticClass:"tweet__info__top__wrapper"},[i("div",{staticClass:"tweet__info__image_wrapper"},[i("router-link",{attrs:{to:{name:"user-tweets",params:{id:e.tweet.User.id}}}},[i("img",{staticClass:"tweet__info__image",attrs:{src:e._f("emptyImage")(e.tweet.User.avatar),alt:"使用者的大頭貼"}})])],1),i("div",{staticClass:"tweet__info__title__wrapper"},[i("router-link",{attrs:{to:{name:"user-tweets",params:{id:e.tweet.User.id}}}},[i("div",{staticClass:"tweet__info__name"},[e._v(" "+e._s(e.tweet.User.name)+" ")]),i("div",{staticClass:"tweet__info__account"},[e._v(" @"+e._s(e.tweet.User.account)+" ")])])],1)]),i("div",{staticClass:"tweet__info__text__wrapper"},[i("div",{staticClass:"tweet__info__text"},[e._v(" "+e._s(e.tweet.description)+" ")])]),i("div",{staticClass:"tweet__info__time__wrapper"},[i("div",{staticClass:"tweet__info__date"},[e._v(" "+e._s(e._f("localTime")(e.tweet.createdAt))+" ")])]),i("div",{staticClass:"tweet__info__reply__wrapper"},[i("div",{staticClass:"tweet__info__reply__number"},[e._v(" "+e._s(e.tweet.replyCount)+" "),i("span",{staticClass:"tweet__info__rely__text"},[e._v("回覆")])]),i("div",{staticClass:"tweet__info__like__number"},[e._v(" "+e._s(e.tweet.likeCount)+" "),i("span",{staticClass:"tweet__info__like__text"},[e._v("喜歡次數")])])]),i("div",{staticClass:"tweet__info__icon__wrapper"},[i("div",{staticClass:"tweet__info__icon__message__wrapper",on:{click:function(t){e.showModal=!0}}},[i("div",{staticClass:"tweet__info__icon__message"})]),i("div",{staticClass:"tweet__info__icon__like__wrapper"},[e.tweet.isLike?i("div",{staticClass:"tweet__info__icon__like--liked",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.removeLiked(e.tweet.id)}}}):i("div",{staticClass:"tweet__info__icon__like",on:{click:function(t){return t.preventDefault(),t.stopPropagation(),e.addLiked(e.tweet.id)}}})]),e.showModal?[i("ReplyPostModal",{attrs:{"initial-tweet":e.initialTweet},on:{close:function(t){e.showModal=!1},"after-submit":e.handleAfterSubmit}})]:e._e()],2)])])}),o=[],_=i("cf6a"),l=i("4cce"),u=i("2708"),d=i("c968"),p=i("2f62"),w={components:{ReplyPostModal:_["default"]},mixins:[u["c"],u["a"]],props:{initialTweet:{type:Object,required:!0}},data:function(){return{showModal:!1,tweet:this.initialTweet}},computed:Object(n["a"])({},Object(p["b"])(["currentUser"])),watch:{initialTweet:function(e){this.tweet=Object(n["a"])(Object(n["a"])({},this.tweet),e)}},methods:{handleAfterSubmit:function(e){this.$emit("after-submit",e.comment),this.tweet.replyCount=this.tweet.replyCount+1},addLiked:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var a,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,l["a"].addLike({tweetId:e});case 3:if(a=i.sent,s=a.data,"success"===s.status){i.next=7;break}throw new Error(s.message);case 7:t.tweet.isLike=!0,t.tweet.likeCount=t.tweet.likeCount+1,t.$socket.emit("reactionNotify",{id:t.currentUser.id,receiverId:t.tweet.User.id,avatar:t.currentUser.avatar,name:t.currentUser.name,labelName:"like"}),i.next=16;break;case 12:i.prev=12,i.t0=i["catch"](0),console.log(i.t0),d["a"].fire({icon:"error",title:"喜歡貼文失敗，請稍候再試"});case 16:case"end":return i.stop()}}),i,null,[[0,12]])})))()},removeLiked:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var a,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,l["a"].removeLike({tweetId:e});case 3:if(a=i.sent,s=a.data,"success"===s.status){i.next=7;break}throw new Error(s.message);case 7:console.log(s),t.tweet.isLike=!1,t.tweet.likeCount=t.tweet.likeCount>0?t.tweet.likeCount-=1:0,i.next=16;break;case 12:i.prev=12,i.t0=i["catch"](0),console.log(i.t0),d["a"].fire({icon:"error",title:"取消喜歡失敗，請稍候再試"});case 16:case"end":return i.stop()}}),i,null,[[0,12]])})))()}}},f=w,v=(i("3d88"),i("2877")),m=Object(v["a"])(f,c,o,!1,null,"d60e0a44",null),h=m.exports,b=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"reply"},[i("div",{staticClass:"reply__avatar "},[i("router-link",{attrs:{to:{name:"user-tweets",params:{id:e.reply.User.id}}}},[i("img",{staticClass:"avatar-img",attrs:{src:e._f("emptyImage")(e.reply.User.avatar),alt:""}})])],1),i("div",{staticClass:"reply__content ml-2"},[i("div",{staticClass:"reply__content__title mb-2"},[i("router-link",{attrs:{to:{name:"user-tweets",params:{id:e.reply.User.id}}}},[i("span",{staticClass:"reply__content__title__item user-name"},[e._v(" "+e._s(e.reply.User.name)+" ")])]),i("span",{staticClass:"reply__content__title__item"},[e._v("@"+e._s(e.reply.User.account))]),i("span",{staticClass:"reply__content__title__item"},[e._v("·")]),i("span",{staticClass:"reply__content__title__item reply__content__title__item__time"},[e._v(" "+e._s(e._f("fromNow")(e.reply.createdAt))+" ")])],1),i("div",{staticClass:"reply__content__object"},[i("span",[e._v("回覆")]),i("span",[e._v("@"+e._s(e.user.account))])]),i("div",{staticClass:"reply__content__discription"},[e._v(" "+e._s(e.reply.comment)+" ")])])])])},C=[],k={mixins:[u["b"],u["a"]],props:{initialUser:{type:Object,required:!0},initialReply:{type:Object,required:!0}},data:function(){return{repliedAccount:"apple",user:this.initialUser,reply:this.initialReply}},watch:{initialUser:function(e){this.user=Object(n["a"])(Object(n["a"])({},this.user),e)},initialReply:function(e){this.reply=Object(n["a"])(Object(n["a"])({},this.reply),e)}}},y=k,g=(i("afb5"),Object(v["a"])(y,b,C,!1,null,"3691d7bf",null)),U=g.exports,x=i("6783"),j=i("2375"),O={components:{TweetInfo:h,Messages:U,Spinner:j["a"]},data:function(){return{tweet:{},replies:[],user:{id:"",account:""},isLoading:!0}},computed:Object(n["a"])({},Object(p["b"])(["currentUser"])),created:function(){var e=this.$route.params.id;this.fetchData(e),this.fetchReplies(e)},beforeRouteUpdate:function(e,t,i){var a=e.params.id;this.fetchData(a),this.fetchReplies(a),i()},methods:{fetchData:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var a,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,t.isLoading=!0,i.next=4,x["a"].getATweet({tweetId:e});case 4:a=i.sent,s=a.data,t.tweet=s,t.user.id=s.User.id,t.user.account=s.User.account,t.isLoading=!1,i.next=16;break;case 12:i.prev=12,i.t0=i["catch"](0),console.log("error",i.t0),d["a"].fire({icon:"error",title:"目前無法讀取該則推文，請稍後再試"});case 16:case"end":return i.stop()}}),i,null,[[0,12]])})))()},fetchReplies:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var a,s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.prev=0,t.isLoading=!0,i.next=4,x["a"].getReplies({tweetId:e});case 4:a=i.sent,s=a.data,t.replies=s,t.isLoading=!1,i.next=13;break;case 10:i.prev=10,i.t0=i["catch"](0),console.log("error",i.t0);case 13:case"end":return i.stop()}}),i,null,[[0,10]])})))()},addTweetAfterSubmit:function(e){this.replies.unshift({comment:e,createdAt:new Date,User:{account:this.currentUser.account,name:this.currentUser.name,avatar:this.currentUser.avatar}})}}},R=O,L=Object(v["a"])(R,a,s,!1,null,null,null);t["default"]=L.exports},afb5:function(e,t,i){"use strict";i("7107")}}]);
//# sourceMappingURL=chunk-0e5a37c2.f4905c54.js.map