(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0a957026"],{"0724":function(t,e,n){"use strict";n("2c43")},"1f48":function(t,e,n){},2909:function(t,e,n){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t){if(Array.isArray(t))return r(t)}n.d(e,"a",(function(){return c}));n("a4d3"),n("e01a"),n("d3b7"),n("d28b"),n("3ca3"),n("ddb0"),n("a630");function a(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}n("fb6a"),n("b0c0");function i(t,e){if(t){if("string"===typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function o(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(t){return s(t)||a(t)||i(t)||o()}},"290e":function(t,e,n){},"2c43":function(t,e,n){},"498a":function(t,e,n){"use strict";var r=n("23e7"),s=n("58a8").trim,a=n("c8d2");r({target:"String",proto:!0,forced:a("trim")},{trim:function(){return s(this)}})},"4cf0":function(t,e,n){"use strict";n("7256")},"4df4":function(t,e,n){"use strict";var r=n("0366"),s=n("7b0b"),a=n("9bdd"),i=n("e95a"),o=n("50c4"),c=n("8418"),u=n("35a1");t.exports=function(t){var e,n,_,l,d,f,m=s(t),v="function"==typeof this?this:Array,h=arguments.length,p=h>1?arguments[1]:void 0,g=void 0!==p,b=u(m),y=0;if(g&&(p=r(p,h>2?arguments[2]:void 0,2)),void 0==b||v==Array&&i(b))for(e=o(m.length),n=new v(e);e>y;y++)f=g?p(m[y],y):m[y],c(n,y,f);else for(l=b.call(m),d=l.next,n=new v;!(_=d.call(l)).done;y++)f=g?a(l,p,[_.value,y],!0):_.value,c(n,y,f);return n.length=y,n}},"505d":function(t,e,n){"use strict";n.r(e);var r=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"main_container"},[n("div",{staticClass:"middle__content"},[n("OnlineUser",{attrs:{"initial-users":t.users}})],1),n("div",{staticClass:"right__content"},[n("ChatRoom",{attrs:{messages:t.messages}})],1)])},s=[],a=n("1da1"),i=n("5530"),o=(n("96cf"),n("159b"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"online_container"},[n("div",{staticClass:"online_container__title"},[t._v(" 上線使用者 ("+t._s(t.initialUsers.length||0)+") ")]),t._l(t.initialUsers,(function(e){return n("div",{key:e.id,staticClass:"online_container__list"},[n("router-link",{attrs:{to:{name:"user-tweets",params:{id:e.id}}}},[n("div",{staticClass:"online_container__list__avatar"},[n("img",{staticClass:"avatar-img",attrs:{src:e.avatar,alt:""}})])]),n("div",{staticClass:"online_container__list__info"},[n("span",{staticClass:"online_container__list__info__name user-name"},[t._v(t._s(e.name))]),n("span",{staticClass:"online_container__list__info__account"},[t._v("@"+t._s(e.account))])])],1)}))],2)}),c=[],u=n("2909"),_=(n("99af"),{name:"OnlineUser",props:{initialUsers:{type:Array,required:!0}},data:function(){return{users:this.initialUsers}},watch:{initialUsers:function(t){this.users=[].concat(Object(u["a"])(this.users),Object(u["a"])(t))}}}),l=_,d=(n("4cf0"),n("0724"),n("2877")),f=Object(d["a"])(l,o,c,!1,null,"ac206358",null),m=f.exports,v=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("form",{attrs:{action:""},on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit.apply(null,arguments)}}},[n("div",{staticClass:"chat__room__container"},[t._m(0),n("div",{ref:"main",staticClass:"chat__room__main__wrapper"},t._l(t.allData,(function(e){return n("div",{key:e.messageId},[1===e.isOnline?n("div",{staticClass:"chat__room__main__info__wraaper"},[n("div",{staticClass:"chat__room__info"},[n("div",{staticClass:"chat__room__info__text"},[t._v(" "+t._s(e.name)+" 上線囉 ")])])]):t._e(),e.id?n("div",{staticClass:"chat__room__message__wrapper"},[e.id!==t.currentUser.id?n("div",{staticClass:"chat__room__left__wrapper"},[n("div",{staticClass:"chat__room__user"},[n("img",{staticClass:"user__image",attrs:{src:t._f("emptyImage")(e.avatar),alt:""}}),n("div",{staticClass:"chat__room__text__container"},[n("div",{staticClass:"chat__room__text__wrapper"},[n("div",{staticClass:"chat__room__text"},[t._v(" "+t._s(e.content)+" ")])]),n("div",{staticClass:"chat__room__time"},[t._v(" "+t._s(t._f("shortenTime")(e.createdAt))+" ")])])])]):t._e(),e.id===t.currentUser.id?n("div",{staticClass:"chat__room__right__wrapper"},[n("div",{staticClass:"chat__room__right__text__wrapper"},[n("div",{staticClass:"chat__room__right__text"},[t._v(" "+t._s(e.content)+" ")])]),n("div",{staticClass:"chat__room__time"},[t._v(" "+t._s(t._f("shortenTime")(e.createdAt))+" ")])]):t._e()]):t._e(),0===e.isOnline?n("div",{staticClass:"chat__room__main__leave__wraaper"},[n("div",{staticClass:"chat__room__leave"},[n("div",{staticClass:"chat__room__leave__text"},[t._v(" "+t._s(e.name)+" 離線了 QQ ")])])]):t._e()])})),0),n("div",{staticClass:"chat__room__bottom__wrapper"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.message,expression:"message"}],staticClass:"chat__room__input",attrs:{type:"text",placeholder:"請輸入訊息..."},domProps:{value:t.message},on:{input:function(e){e.target.composing||(t.message=e.target.value)}}}),n("button",{staticClass:"chat__room__button",attrs:{type:"submit"}})])])])},h=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"chat__room__top__wrapper"},[n("div",{staticClass:"chat__room__title"},[t._v(" 公開聊天室 ")])])}],p=(n("498a"),n("2f62")),g=n("c968"),b=n("2708"),y={name:"ChatRoom",mixins:[b["e"],b["a"]],props:{messages:{type:Array,required:!0}},data:function(){return{message:"",allData:this.messages}},computed:Object(i["a"])({},Object(p["b"])(["currentUser"])),created:function(){this.scrollToEnd(),console.log(this.$refs.main)},mounted:function(){this.scrollToEnd()},updated:function(){this.scrollToEnd()},methods:{handleSubmit:function(){this.message?this.message.trim()?(this.$socket.emit("chatMessage",Object(i["a"])(Object(i["a"])({},this.currentUser),{},{content:this.message,createdAt:new Date,avatar:this.currentUser.avatar})),this.message=""):g["a"].fire({icon:"warning",title:"送一堆空格要幹嘛!?"}):g["a"].fire({icon:"warning",title:"沒有話要說，就不要亂按"})},scrollToEnd:function(){this.$refs.main.scrollTop=this.$refs.main.scrollHeight}}},C=y,w=(n("f6ac"),Object(d["a"])(C,v,h,!1,null,"e0ea4dc8",null)),x=w.exports,A=n("d3cc"),O={name:"PublicChatViews",components:{OnlineUser:m,ChatRoom:x},data:function(){return{users:[],messages:[]}},computed:Object(i["a"])({},Object(p["b"])(["currentUser"])),beforeRouteUpdate:function(){this.$socket.connect()},created:function(){this.$socket.emit("currentUser",Object(i["a"])({},this.currentUser))},beforeDestroy:function(){console.log("leave")},destroyed:function(){console.log("請重新連接")},mounted:function(){this.historyMessage()},methods:{historyMessage:function(){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A["a"].messages({isPrivate:!1,id:t.currentUser.id,listenerId:0});case 3:n=e.sent,r=n.data,r.forEach((function(e){t.messages.push(e)})),e.next=11;break;case 8:e.prev=8,e.t0=e["catch"](0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}},sockets:{connect:function(){console.log("socket connected")},disconnect:function(){console.log("socket disconnected!!!!!!!!!!!")},users:function(t){this.users=t},userConnected:function(t){this.messages.push(t)},userDisconnected:function(t){this.messages.push(t)},chatMessage:function(t){this.messages.push(t)}}},U=O,j=(n("9205"),Object(d["a"])(U,r,s,!1,null,"e9093d94",null));e["default"]=j.exports},7256:function(t,e,n){},9205:function(t,e,n){"use strict";n("290e")},"99af":function(t,e,n){"use strict";var r=n("23e7"),s=n("d039"),a=n("e8b5"),i=n("861d"),o=n("7b0b"),c=n("50c4"),u=n("8418"),_=n("65f0"),l=n("1dde"),d=n("b622"),f=n("2d00"),m=d("isConcatSpreadable"),v=9007199254740991,h="Maximum allowed index exceeded",p=f>=51||!s((function(){var t=[];return t[m]=!1,t.concat()[0]!==t})),g=l("concat"),b=function(t){if(!i(t))return!1;var e=t[m];return void 0!==e?!!e:a(t)},y=!p||!g;r({target:"Array",proto:!0,forced:y},{concat:function(t){var e,n,r,s,a,i=o(this),l=_(i,0),d=0;for(e=-1,r=arguments.length;e<r;e++)if(a=-1===e?i:arguments[e],b(a)){if(s=c(a.length),d+s>v)throw TypeError(h);for(n=0;n<s;n++,d++)n in a&&u(l,d,a[n])}else{if(d>=v)throw TypeError(h);u(l,d++,a)}return l.length=d,l}})},"9bdd":function(t,e,n){var r=n("825a"),s=n("2a62");t.exports=function(t,e,n,a){try{return a?e(r(n)[0],n[1]):e(n)}catch(i){throw s(t),i}}},a630:function(t,e,n){var r=n("23e7"),s=n("4df4"),a=n("1c7e"),i=!a((function(t){Array.from(t)}));r({target:"Array",stat:!0,forced:i},{from:s})},c8d2:function(t,e,n){var r=n("d039"),s=n("5899"),a="​᠎";t.exports=function(t){return r((function(){return!!s[t]()||a[t]()!=a||s[t].name!==t}))}},d28b:function(t,e,n){var r=n("746f");r("iterator")},d3cc:function(t,e,n){"use strict";n("99af");var r=n("c968");e["a"]={getPrivateUsers:function(t){return r["b"].get("/messages/users/".concat(t,"/messaged"))},messages:function(t){var e=t.isPrivate,n=t.id,s=t.listenerId;return r["b"].get("/messages?isPrivate=".concat(e,"&id=").concat(n,"&listenerId=").concat(s))}}},e01a:function(t,e,n){"use strict";var r=n("23e7"),s=n("83ab"),a=n("da84"),i=n("5135"),o=n("861d"),c=n("9bf2").f,u=n("e893"),_=a.Symbol;if(s&&"function"==typeof _&&(!("description"in _.prototype)||void 0!==_().description)){var l={},d=function(){var t=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof d?new _(t):void 0===t?_():_(t);return""===t&&(l[e]=!0),e};u(d,_);var f=d.prototype=_.prototype;f.constructor=d;var m=f.toString,v="Symbol(test)"==String(_("test")),h=/^Symbol\((.*)\)[^)]+$/;c(f,"description",{configurable:!0,get:function(){var t=o(this)?this.valueOf():this,e=m.call(t);if(i(l,t))return"";var n=v?e.slice(7,-1):e.replace(h,"$1");return""===n?void 0:n}}),r({global:!0,forced:!0},{Symbol:d})}},f6ac:function(t,e,n){"use strict";n("1f48")},fb6a:function(t,e,n){"use strict";var r=n("23e7"),s=n("861d"),a=n("e8b5"),i=n("23cb"),o=n("50c4"),c=n("fc6a"),u=n("8418"),_=n("b622"),l=n("1dde"),d=l("slice"),f=_("species"),m=[].slice,v=Math.max;r({target:"Array",proto:!0,forced:!d},{slice:function(t,e){var n,r,_,l=c(this),d=o(l.length),h=i(t,d),p=i(void 0===e?d:e,d);if(a(l)&&(n=l.constructor,"function"!=typeof n||n!==Array&&!a(n.prototype)?s(n)&&(n=n[f],null===n&&(n=void 0)):n=void 0,n===Array||void 0===n))return m.call(l,h,p);for(r=new(void 0===n?Array:n)(v(p-h,0)),_=0;h<p;h++,_++)h in l&&u(r,_,l[h]);return r.length=_,r}})}}]);
//# sourceMappingURL=chunk-0a957026.91de51fa.js.map